# UI 입력 차단 오버레이와 깜빡임 완화 가이드

문서 버전: v1.0.0  
문서 상태: Stable  
작성일: 2025-10-21  
작성자: Core Team  
관련 이슈: 주/월/년/전체 탭 연타 시 화면 깜빡임 현상  

변경 이력
- v1.0.0 (2025-10-21): RecordsScreen에 240ms 입력 차단 오버레이 도입. 주/월/년/전체 연타 시 깜빡임 완화.

---

## 1) 배경
금연 기록 화면에서 기간 탭(주/월/년/전체)을 빠르게 반복 클릭할 경우, Compose 재구성이 짧은 시간에 여러 번 발생해 리스트/통계 카드가 다시 그려지면서 "깜빡임"으로 인지되는 시각적 불안정이 보고되었습니다.

## 2) 증상 및 재현
- 기록 화면 상단의 기간 탭을 연속으로 빠르게 탭(예: 월 → 년 → 전체 → 월 …)하면, 본문 내용이 즉시 다시 그려지며 깜빡임처럼 보임
- 바텀시트(세부 기간 선택)가 열리고 닫히는 타이밍과 겹치면 현상이 더 두드러질 수 있음

## 3) 원인 분석(요약)
- 다중 입력으로 짧은 시간 내 상태 전환이 연속 발생 → Compose 레이아웃/측정/그림이 반복 → 시각적으로 깜빡이는 느낌
- 전환 애니메이션(없더라도)과 데이터 필터링, LazyColumn 영역 갱신이 겹치면 불안정 체감이 커짐

## 4) 해결 전략(개요)
- 기간 전환 직후 아주 짧은 시간(수백 ms) 동안 화면 최상단에 투명한 "입력 차단 오버레이"를 띄워 추가 탭/스크롤 입력을 흡수합니다.
- 오버레이가 내려가면(수백 ms 후) 평소처럼 입력을 받습니다. 이렇게 하면 중복 상태 전환이 줄어 깜빡임 체감이 줄어듭니다.
- 바텀시트가 열려 있을 때는(시트가 배경 입력을 자체 차단) 오버레이를 띄우지 않습니다.

## 5) 구현 상세
- 변경 파일: `app/src/main/java/com/sweetapps/nosmoketimer/feature/records/components/RecordsScreen.kt`
- 핵심 로직:
  - 상태: `blockInput: Boolean` — 입력 차단 여부 플래그
  - 트리거: `LaunchedEffect(selectedPeriod)` — 기간 탭이 바뀔 때마다 240ms 동안 `blockInput = true`로 설정 후 자동 해제
  - 오버레이: 최상단 `Box`에 `fillMaxSize + zIndex(1f) + clickable(indication = null)`로 투명한 클릭 흡수 레이어 추가
  - 바텀시트 상태: `showBottomSheet == true`이면 오버레이 비활성화
- 기본 차단 시간: 240ms (기기 성능/느낌에 따라 200~300ms 사이로 조정 권장)

## 6) 설정/튜닝 방법
- 차단 시간 변경: `RecordsScreen.kt` 내 `delay(240)` 값을 원하는 ms로 변경
- 차단 범위 축소(선택): 전체 화면 대신 기간 탭 영역에만 오버레이를 얹어 스크롤은 계속 허용하도록 바꿀 수 있음(필요 시 후속 작업)
- 탭 단위 비활성화(대안/보완): `PeriodSelectionSection`에 `enabled = !blockInput`를 내려 탭만 잠깐 비활성화하는 방식도 가능

## 7) 영향 및 리스크
- 전환 직후 240ms 동안 사용자 입력이 일시 차단됨(의도된 동작). 비가시적이며 매우 짧아 UX 영향은 미미함.
- 바텀시트 조작에는 영향 없음(열려 있을 때 오버레이 미적용).

## 8) QA 체크리스트
- [ ] 기간 탭을 매우 빠르게 연타해도 이전 대비 깜빡임 체감이 줄어드는가?
- [ ] 전환 직후 240ms 이내 추가 탭이 실제로 먹히지 않는가(의도된 차단)?
- [ ] 바텀시트가 열려 있을 때 배경 탭이 차단되는 기본 동작에 영향이 없는가?
- [ ] + 버튼(기록 추가), 카드 클릭(상세 이동), "모든 기록 보기" 버튼이 정상 동작하는가?
- [ ] 스크롤, 뒤로가기 등 기본 네비게이션 동작에 이상이 없는가?

## 9) 롤백 가이드
- `RecordsScreen.kt`에서 `blockInput` 상태, `LaunchedEffect(selectedPeriod)`의 `delay(240)` 로직, 그리고 최상단 입력 차단 `Box` UI를 제거하면 원복됩니다.
- 코드 영향 범위가 작고 독립적이어서 쉽게 되돌릴 수 있습니다.

## 10) 향후 개선 아이디어
- 기간 전환 애니메이션 도입(크로스페이드 등)으로 전환 체감을 더 부드럽게
- LazyColumn 영역에 대한 Diff 기반 업데이트(가능 범위에서)로 재그림 최소화
- 데이터 필터 연산 최적화/메모이제이션 강화
- 탭 컴포넌트에 자체 디바운스/쓰로틀 도입(예: 150~250ms)

## 11) FAQ
- Q: "레이어를 위에 올려 차단"이 정확히 무슨 뜻인가요?  
  A: 화면의 가장 위(z축 상단)에 투명한 뷰를 잠깐 띄워 터치 이벤트를 흡수(무시)하는 것을 의미합니다. 사용자 눈에는 보이지 않지만, 그 사이에 발생하는 불필요한 추가 입력을 막아 UI를 안정시킵니다.

- Q: 왜 240ms인가요?  
  A: 일반적인 전환/재구성 안정화에 충분하면서 체감 지연이 거의 없는 타협값입니다. 기기나 사용자 피드백에 따라 200~300ms 사이로 조정하세요.

- Q: 바텀시트가 열릴 때는 어떻게 되나요?  
  A: 바텀시트가 배경 입력을 기본적으로 차단하므로 별도 오버레이는 띄우지 않습니다.

